<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆè¨ºæ–­ãƒ„ãƒ¼ãƒ«</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 10px;
      margin: 0;
    }

    #startScreen {
      text-align: center;
      padding: 30px;
      max-width: 500px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    #diagnoseBtn {
      background-color: #007bff;
      color: #fff;
      padding: 10px 20px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    #chat {
      background: #fff;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      max-width: 500px;
      margin: 0 auto;
    }

    .msg {
      margin-bottom: 15px;
      line-height: 1.6;
      font-size: 16px;
    }

    .bot { color: #333; }
    .user { color: #007bff; text-align: right; }

    button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: #007bff;
      color: white;
      cursor: pointer;
      margin: 5px 0;
      font-size: 16px;
      width: 100%;
      box-sizing: border-box;
    }

button:hover {
 opacity: 0.7;
}

    button.ghost {
      background: #ccc;
      color: #333;
    }

#terms-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 10px;
}


    /* èªå¥é¸æŠãƒœã‚¿ãƒ³ */
    .word-button {
      background-color: #e0e0e0;
      color: #333;
      border: 1px solid #ccc;
      padding: 10px 15px;
      margin: 5px 0;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
      font-size: 16px;
      width: 100%;
      box-sizing: border-box;
    }

    .word-button:hover {
      background-color: #d5d5d5;
    }

    /* é¸æŠä¸­ */
    .word-button.selected {
      background-color: #007bff; /* ç·‘ç³»#28a745 */
      color: #fff;
    }

    /* çµæœãƒœã‚¿ãƒ³ï¼ˆå·®åˆ¥åŒ–ï¼‰ */
    .result-button-container {
      text-align: center;
      margin-top: 20px;
    }

    .result-button {
      background-color: #007bff; /* ç·‘ç³»#4CAF50 */
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
      transition: background-color 0.2s;
      width: 100%;
    }

    .result-button:hover {
      background-color: #007bee; /* ç·‘ç³»#45A049 */
    }

    .score {
      font-weight: bold;
      display: block;
      margin-top: 8px;
    }

    #resultChart {
      display: block;
      margin: 20px auto;
      background: transparent;
      max-width: 100%;
      height: auto;
    }

#result-buttons {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
  margin-top: 20px;
}

.action-btn {
  display: block;
  width: 340px;
  max-width: 90%;
  margin: 10px auto;
  padding: 10px;
  border-radius: 8px;
  font-size: 16px;
  text-align: center;
  text-decoration: none;
  cursor: pointer;
  box-sizing: border-box;
  transition: background-color 0.3s;
}

/* Xã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ */
.share-btn {
  background-color: #1DA1F2;
  color: #fff;
  font-weight: bold;
}
.share-btn:hover {
  background-color: #0d8ddb;
}

.share-btn a {
  display: inline-block;
  background-color: #1da1f2;
  border: 0.5px solid #6600ff;
  color: #fff;
  padding: 10px 20px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: bold;
}

/* å†è¨ºæ–­ãƒœã‚¿ãƒ³ */
.ghost {
  background-color: #fff;
  border: 0.5px solid #666;
  color: #333;
}
.ghost:hover {
  background-color: #f0f0f0;
}

/* noteãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ */
.note-btn {
  background-color: #f5f5f5;
  border: 0.5px solid #666;
  color: #000;
}
.note-btn:hover {
  background-color: #eaeaea;
}


    @media (min-width: 600px) {
      body {
        padding: 20px;
      }
    }
  </style>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="startScreen">
    <h2>å­¦ç¿’ã¨æˆé•·ã®çµ„ç¹”è¨ºæ–­</h2>
    <p>ã‚ãªãŸã®æ‰€å±ã™ã‚‹çµ„ç¹”ï¼ˆãƒãƒ¼ãƒ ï¼‰ã®<br>
      å­¦ç¿’ã¨æˆé•·ã«ã¤ã„ã¦ã®çµ„ç¹”è¨ºæ–­ã§ã™ã€‚<br><br>

      å¿ƒç†çš„å®‰å…¨æ€§ã¨æŒ‘æˆ¦åº¦ã‚’ç‚¹æ•°åŒ–ã—<br>ä¸¡è€…ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ãƒãƒˆãƒªã‚¯ã‚¹ã§<br>
      è¡¨ç¤ºã™ã‚‹ã“ã¨ã§çµ„ç¹”ï¼ˆãƒãƒ¼ãƒ ï¼‰ã®<br>
      çŠ¶æ³ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><br>
    
      <p>
      æ‰€è¦æ™‚é–“ 3åˆ†ç¨‹åº¦<br>
      è³ªå•æ•° 8å•<br><br>
      </p>          
    
    <button id="diagnoseBtn">è¨ºæ–­ã—ã¦ã¿ã‚‹</button>

  </div>


<div id="chat-container" style="display: none;">
  <div id="chat"></div>
  <div id="result-section" style="text-align: center; margin-top: 20px;">
  <canvas id="resultChart" width="360" height="360"></canvas>
  <br>
  <div id="result-buttons" style="margin-top: 20px;"></div>
  </div>
</div>


<script>

  const startScreen = document.getElementById('startScreen');
  const chatContainer = document.getElementById('chat-container');
  const diagnoseBtn = document.getElementById('diagnoseBtn');

  diagnoseBtn.addEventListener('click', () => {
    startScreen.style.display = 'none';
    chatContainer.style.display = 'block';
  });





// ================================
// è³ªå•ãƒ‡ãƒ¼ã‚¿
// ================================
const QUESTIONS = [
  { text: "ã‚ãªãŸã®ãƒãƒ¼ãƒ ï¼ˆçµ„ç¹”ï¼‰ã§ã¯ã€ç«‹å ´ã‚„å½¹è·ã«é–¢ä¿‚ãªãè‡ªç”±ã«æ„è¦‹ã‚’è¨€ãˆã‚‹é›°å›²æ°—ãŒã‚ã‚Šãƒã‚¹ã‚«ï¼Ÿ", attributes: { P: 1, C: 0 } },
  { text: "ã‚ãªãŸã®ãƒãƒ¼ãƒ ï¼ˆçµ„ç¹”ï¼‰ã¯ç¾çŠ¶ã«æº€è¶³ã›ãšã«ã€å¸¸ã«æ”¹å–„ã‚„æˆé•·ã‚’ç›®æŒ‡ã—ã¦ã„ãƒã‚¹ã‚«ï¼Ÿ", attributes: { P: 0, C: 1 } },
  { text: "ãƒãƒ¼ãƒ ï¼ˆçµ„ç¹”ï¼‰å†…ã§é–“é•ã„ã‚„å¤±æ•—ã‚’ã—ã¦ã‚‚è²¬ã‚ã‚‰ã‚Œã‚‹ã“ã¨ãªãå—ã‘å…¥ã‚Œã‚‰ã‚Œã‚‹ã¨æ„Ÿã˜ã‚‰ã‚Œãƒã‚¹ã‚«ï¼Ÿ", attributes: { P: 1, C: 0 } },
  { text: "é«˜ã„ç›®æ¨™ã«å‘ã‹ã†ä¸­ã§å®‰å¿ƒã—ã¦æ„è¦‹ã‚„ç–‘å•ã‚’è¨€ãˆã‚‹é›°å›²æ°—ãŒã‚ã‚Šãƒã‚¹ã‚«ï¼Ÿ", attributes: { P: 1, C: 1 } },
  { text: "ãƒãƒ¼ãƒ ï¼ˆçµ„ç¹”ï¼‰ã®ç›®æ¨™ã¯é”æˆãŒå®¹æ˜“ã§ã¯ãªãã€ã‚„ã‚„é«˜ã‚ï½é«˜ã‚ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã¨æ„Ÿã˜ãƒã‚¹ã‚«ï¼Ÿ", attributes: { P: 0, C: 1 } },
  { text: "å¤±æ•—ã—ã¦ã‚‚ãƒãƒ¼ãƒ ï¼ˆçµ„ç¹”ï¼‰ã¯ãã‚Œã‚’å­¦ã³ã®æ©Ÿä¼šã¨ã—ã¦å—ã‘æ­¢ã‚ã¦ã„ãƒã‚¹ã‚«ï¼Ÿ", attributes: { P: 1, C: 1 } },
  { text: "ãƒãƒ¼ãƒ ï¼ˆçµ„ç¹”ï¼‰ã§ã¯ã€å›°é›£ãªèª²é¡Œã«å¯¾ã—ã¦äº’ã„ã«æ”¯æ´ã—åˆã†æ–‡åŒ–ãŒã‚ã‚Šãƒã‚¹ã‚«ï¼Ÿ", attributes: { P: 1, C: 1 } }
];

// ================================
// è£œæ­£ç”¨èªå¥ãƒ‡ãƒ¼ã‚¿
// ================================
const TERMS = [
  { key: "ç™’ã—", adjust: { P: -0.5, C: 0.0 } },
  { key: "å¤šæ§˜æ€§", adjust: { P: -0.3, C: 0.0 } },
  { key: "å®‰å®šæ„Ÿ", adjust: { P: 0, C: 0.2 } },
  { key: "ã‚†ã¨ã‚Š", adjust: { P: -0.5, C: 0.0 } },
  { key: "å…±æ„Ÿ", adjust: { P: -0.8, C: 0.0 } },
  { key: "å‰µæ„å·¥å¤«", adjust: { P: -0.3, C: -0.2 } },
  { key: "è‡ªä¸»æ€§", adjust: { P: -0.2, C: -0.4 } },
  { key: "å”èª¿æ€§", adjust: { P: -0.2, C: 0 } },
  { key: "å‘ä¸Šå¿ƒ", adjust: { P: 0.0, C: -1.0 } },
  { key: "æƒ…ç†±", adjust: { P: 0.0, C: -0.8 } },
  { key: "ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿ", adjust: { P: 0.0, C: -0.2 } },
  { key: "åŠ¹ç‡æ€§", adjust: { P: 0.0, C: 0.0 } }
];

// ================================
// çŠ¶æ…‹ç®¡ç†
// ================================
let currentQuestion = 0;
let pScore = 0;
let cScore = 0;
let selectedTerms = [];

// ================================
// ã‚¿ã‚¤ãƒ—ãƒ©ã‚¤ã‚¿ãƒ¼æ¼”å‡ºä»˜ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
// ================================
function addMsg(text, sender = "bot", element = null) {
  const div = document.createElement("div");
  div.className = `msg ${sender}`;

  if (element) {
    div.appendChild(element);
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  } else {
    chat.appendChild(div);
    typeWriter(div, text);
  }
}

function typeWriter(target, htmlText, speed = 20) {
  let i = 0;
  let isTag = false;
  let tagBuffer = "";

  function type() {
    if (i < htmlText.length) {
      const char = htmlText[i];
      if (char === "<") {
        isTag = true;
        tagBuffer += char;
      } else if (char === ">") {
        tagBuffer += char;
        target.innerHTML += tagBuffer;
        tagBuffer = "";
        isTag = false;
      } else if (isTag) {
        tagBuffer += char;
      } else {
        target.innerHTML += char;
      }
      i++;
      chat.scrollTop = chat.scrollHeight;
      setTimeout(type, speed);
    }
  }

  type();
}

    // ===================================
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ ï¼ˆã‚¿ã‚¤ãƒ—ãƒ©ã‚¤ã‚¿ãƒ¼æ¼”å‡ºãªã—ï¼‰
    // ===================================
    function addMsg2(text, sender = "bot", element = null) {
      const div = document.createElement("div");
      div.className = `msg ${sender}`;
      if (element) {
        div.appendChild(element);
      } else {
        div.innerHTML = text;
      }
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }


// =================================
// è³ªå•ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã®å‡¦ç†
// =================================
/*const startBtn = document.getElementById('startBtn');

startBtn.addEventListener('click', () => {
    
const chat = document.getElementById("chat");



  // ================================
  // æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  // ================================
  addMsg("ğŸ¤–ï¼šã‚³ã‚“ã«ãƒã¯ï¼<br><br>ä»Šã‚«ãƒ©ã€<strong>â€œå­¦ç¿’ã¨æˆé•·â€</strong>ã«ã¤ã„ã¦ã® çµ„ç¹”è¨ºæ–­ ãƒ²å§‹ã‚ãƒã‚¹ã€‚<br><br>ã‚³ãƒ¬ã‹ã‚‰ã‚¢ãƒŠã‚¿ãŒæ‰€å±ã—ã¦ã„ã‚‹çµ„ç¹”ï¼ˆãƒãƒ¼ãƒ ï¼‰ã«ãƒ„ã‚¤ãƒ†<strong>7å•</strong>ã®è³ªå•ã‚’ã—ã¦ã‚¤ã‚­ãƒã‚¹ã€‚<br><br>é¸æŠè‚¢ã®ä¸­ã‚«ãƒ©ã€ã‚¢ãƒŠã‚¿ã®è€ƒãˆã«ä¸€ç•ªè¿‘ã„å›ç­”ãƒ²é¸ã‚“ã§ã‚¯ãƒ€ã‚µã‚¤ã€‚", "bot");

  setTimeout(() => {
  addMsg("<br>å›ç­”æ‰€è¦æ™‚é–“ã®ç›®å®‰ã¯<strong> 3åˆ† </strong>ç¨‹ãƒ‡ã‚¹ã€‚<br><br>", "bot");
  }, 4500);


  setTimeout(() => {
  const startBtn = document.createElement("button");
  startBtn.textContent = "è³ªå•ã‚¹ã‚¿ãƒ¼ãƒˆ";
  startBtn.addEventListener("click", () => {
    startBtn.remove();
    showQuestion();
  });
  addMsg("", "bot", startBtn);
  }, 6000);


});
*/


diagnoseBtn.addEventListener('click', () => {
  startScreen.style.display = 'none';
  chatContainer.style.display = 'block';

  const chat = document.getElementById("chat");

  // æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
  addMsg("ğŸ¤–ï¼šã‚³ã‚“ã«ãƒã¯ï¼<br><br>ä»Šã‚«ãƒ©ã€<strong>â€œå­¦ç¿’ã¨æˆé•·â€</strong>ã«ã¤ã„ã¦ã® çµ„ç¹”è¨ºæ–­ ãƒ²å§‹ã‚ãƒã‚¹ã€‚<br><br>ã‚³ãƒ¬ã‹ã‚‰ã‚¢ãƒŠã‚¿ãŒæ‰€å±ã—ã¦ã„ã‚‹çµ„ç¹”ï¼ˆãƒãƒ¼ãƒ ï¼‰ã«ãƒ„ã‚¤ãƒ†<strong>7å•</strong>ã®è³ªå•ã‚’ã—ã¦ã‚¤ã‚­ãƒã‚¹ã€‚<br><br>é¸æŠè‚¢ã®ä¸­ã‚«ãƒ©ã€ã‚¢ãƒŠã‚¿ã®è€ƒãˆã«ä¸€ç•ªè¿‘ã„å›ç­”ãƒ²é¸ã‚“ã§ã‚¯ãƒ€ã‚µã‚¤ã€‚", "bot");

  setTimeout(() => {
    addMsg("<br>å›ç­”æ‰€è¦æ™‚é–“ã®ç›®å®‰ã¯<strong> 3åˆ† </strong>ç¨‹ãƒ‡ã‚¹ã€‚<br><br>", "bot");
  }, 4500);

  setTimeout(() => {
    const qStartBtn = document.createElement("button");
    qStartBtn.textContent = "è³ªå•ã‚¹ã‚¿ãƒ¼ãƒˆ";
    qStartBtn.addEventListener("click", () => {
      qStartBtn.remove();
      showQuestion();
    });
    addMsg("", "bot", qStartBtn);
  }, 6000);
});





// ================================
// è³ªå•è¡¨ç¤º
// ================================
function showQuestion() {
  chat.innerHTML = "";
  if (currentQuestion < QUESTIONS.length) {
    const q = QUESTIONS[currentQuestion];
    addMsg(`ğŸ¤–ï¼š<strong>Q${currentQuestion + 1}.</strong> ${q.text}`, "bot");


setTimeout(() => {
    const options = document.createElement("div");
    options.className = "options";

    const choices = [
      { text: "å¼·ããã†æ€ã†", value: 3 },
      { text: "ã©ã¡ã‚‰ã‹ã¨ã„ãˆã°ãã†æ€ã†", value: 2 },
      { text: "ã©ã¡ã‚‰ã‹ã¨ã„ãˆã°ãã†æ€ã‚ãªã„", value: 1 },
      { text: "å…¨ããã†æ€ã‚ãªã„", value: 0 }
    ];


    choices.forEach(choice => {
      const btn = document.createElement("button");
      btn.textContent = choice.text;
      btn.addEventListener("click", () => {
        pScore += choice.value * q.attributes.P;
        cScore += choice.value * q.attributes.C;
        currentQuestion++;
        showQuestion();
      });
      options.appendChild(btn);
    });


    addMsg("", "bot", options);
}, 1700);
  } else {
    showTermsSelection();
  }
}


// ================================
// èªå¥é¸æŠç”»é¢
// ================================
function showTermsSelection() {
  chat.innerHTML = "";
  addMsg("ğŸ¤–ï¼šæœ€å¾Œã«ã‚¢ãƒŠã‚¿ãŒæ‰€å±ã—ã¦ã„ã‚‹çµ„ç¹”ï¼ˆãƒãƒ¼ãƒ ï¼‰ã«â€œ<strong>ä¸è¶³</strong>ã—ã¦ã„ã‚‹ã¨æ€ã†ã‚‚ã®â€ãƒ²é¸ã‚“ã§ãƒã€‚ï¼ˆ<strong>æœ€å¤§3ã¤ã¾ã§</strong>é¸æŠå¯ã€<strong>é¸ã°ãªãã¦ã‚‚OK</strong>ï¼‰", "bot");

  const termsContainer = document.createElement("div");
  termsContainer.id = "terms-container";

  TERMS.forEach(term => {
    const btn = document.createElement("button");
    btn.textContent = term.key;
    btn.className = "word-button";

    btn.addEventListener("click", () => {
      if (!selectedTerms.includes(term)) {
        if (selectedTerms.length >= 3) {
          alert("é¸æŠã§ãã‚‹ã®ã¯æœ€å¤§3ã¤ã¾ã§ã§ã™ã€‚");
          return;
        }
        selectedTerms.push(term);
        btn.classList.add("selected");
      } else {
        selectedTerms = selectedTerms.filter(t => t !== term);
        btn.classList.remove("selected");
      }
    });

    termsContainer.appendChild(btn);
  });
  addMsg("", "bot", termsContainer);

  const resultContainer = document.createElement("div");
  resultContainer.className = "result-button-container";

setTimeout(() => {
  const nextBtn = document.createElement("button");
  nextBtn.textContent = "è¨ºæ–­çµæœã‚’è¦‹ã‚‹";
  nextBtn.className = "result-button";
  nextBtn.addEventListener("click", () => {
    showResult();
  });
  resultContainer.appendChild(nextBtn);

  addMsg("", "bot", resultContainer);
}, 2000);
}

// ================================
// è£œæ­£é©ç”¨
// ================================
function applyTermAdjustments(p, c, terms) {
  let finalP = p;
  let finalC = c;
  const maxScore = 15;

  terms.forEach(term => {
    finalP += term.adjust.P;
    finalC += term.adjust.C;
  });

  finalP = Math.max(finalP, 0);
  finalC = Math.max(finalC, 0);

  finalP = Math.round((finalP / maxScore) * 100);
  finalC = Math.round((finalC / maxScore) * 100);

  return { P: finalP, C: finalC };
}

// ===== èƒŒæ™¯ç”»åƒãƒ—ãƒ©ã‚°ã‚¤ãƒ³ =====
const backgroundImagePlugin = {
  id: 'backgroundImage',
  beforeDraw: (chart) => {
    const { ctx, chartArea } = chart;
    const image = chart.config._config.options.backgroundImage;
    if (image) {
      ctx.save();
      ctx.globalAlpha = 1.0;
      ctx.drawImage(image, chartArea.left, chartArea.top, chartArea.width, chartArea.height);
      ctx.restore();
    }
  }
};


// ================================
// çµæœã‚³ãƒ¡ãƒ³ãƒˆåˆ¤å®šé–¢æ•°
// ================================
/*
function getResultComment(p, c) {
  // Pã‚¹ã‚³ã‚¢70ä»¥ä¸Šã‹ã¤Cã‚¹ã‚³ã‚¢70ä»¥ä¸Š
  if (p >= 70 && c >= 70) {
    return "ç†æƒ³çš„ãªçŠ¶æ…‹ã¨è¨€ãˆãã†ãƒ‡ã‚¹ã€‚ã“ã®çŠ¶æ…‹ã‚’ç¶™ç¶šã—ã¦ã„ãã¾ã‚·ãƒ§ã‚¦ã€‚";
  }

  // Pã‚¹ã‚³ã‚¢65ä»¥ä¸Šã‹ã¤Cã‚¹ã‚³ã‚¢40æœªæº€
  if (p >= 65 && c < 40) {
    return "å¿ƒç†çš„å®‰å…¨æ€§ã¯ã‚ã‚‹ç¨‹åº¦ã®é«˜ã•ãŒã‚ã‚‹ã®ãƒ‡ã€ã‚‚ã†å°‘ã—æŒ‘æˆ¦ã®ãƒ¬ãƒ™ãƒ«ã‚’ä¸Šã’ãŸæ–¹ãŒã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã‚»ãƒ³ã€‚æŒ‘æˆ¦ã®ãƒ¬ãƒ™ãƒ«ãŒä½ã™ãã‚‹ã¨â€œã‚„ã‚ŠãŒã„â€ãŒä½ä¸‹ã—ã€é›¢è·ã«ã¤ãªãŒã£ã¦ã—ã¾ã†ã“ã¨ãŒã‚¢ãƒªãƒã‚¹ã€‚";
  }

  // Pã‚¹ã‚³ã‚¢40æœªæº€ã‹ã¤Cã‚¹ã‚³ã‚¢60ä»¥ä¸Š
  if (p < 40 && c >= 60) {
    return "æŒ‘æˆ¦ã®é«˜ã•ã«å¯¾ã—ã¦ã€å¿ƒç†çš„å®‰å…¨æ€§ã®é«˜ã•ãŒè¦‹åˆã£ã¦ã‚¤ãƒŠã‚¤ã‚ˆã†ãƒ‡ã‚¹ã€‚ä¸€æ™‚çš„ã«ã¯ä¹—ã‚Šè¶Šãˆã‚‰ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã‚¬ã€ã“ã®çŠ¶æ…‹ã¯æ±ºã—ã¦å¥å…¨ã¨ã¯è¨€ãˆã¾ã‚»ãƒ³ã€‚å¿ƒç†çš„å®‰å…¨æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã®çµ„ç¹”æ”¹å–„ã‚’ãŠã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã€‚";
  }

  // ã©ã¡ã‚‰ã‚‚ä½ã„å ´åˆï¼ˆPã‚¹ã‚³ã‚¢40æœªæº€ã‹ã¤Cã‚¹ã‚³ã‚¢40æœªæº€ï¼‰
  if (p < 40 && c < 40) {
    return "å¿ƒç†çš„å®‰å…¨æ€§ã‚‚æŒ‘æˆ¦ã‚‚ä½ã„çŠ¶æ…‹ãƒ‡ã‚¹ã€‚çµ„ç¹”ã®åœæ»ã‚’æ‹›ãå¯èƒ½æ€§ãŒé«˜ãã€ãƒã‚ºã¯å¿ƒç†çš„ãªéƒ¨åˆ†ã§å®‰å¿ƒã«ã¤ãªãŒã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç’°å¢ƒã¥ãã‚Šã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã‚’ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã€‚";
  }

  // Pã‚¹ã‚³ã‚¢65ä»¥ä¸Šã‹ã¤Pã‚¹ã‚³ã‚¢ã¨Cã‚¹ã‚³ã‚¢ã®å·®ãŒ15ä»¥ä¸Š
  if (p >= 65 && p - c >= 15) {
    return "å¿ƒç†çš„å®‰å…¨æ€§ã¯ã‚ã‚‹ç¨‹åº¦ã®é«˜ã•ãŒã‚ã‚‹ã®ãƒ‡ã€ã‚‚ã†å°‘ã—æŒ‘æˆ¦ã®ãƒ¬ãƒ™ãƒ«ã‚’ä¸Šã’ãŸæ–¹ãŒã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã‚»ãƒ³ã€‚";
  }

  // Pã‚¹ã‚³ã‚¢ãŒ50æœªæº€ã‹ã¤Cã‚¹ã‚³ã‚¢ã¨Pã‚¹ã‚³ã‚¢ã®å·®ãŒ10ä»¥ä¸Š
  if (p < 40 && c - p >= 10) {
    return "å¿ƒç†çš„å®‰å…¨æ€§ã‚’ä¸Šã’ã¦ã„ãã¾ã—ã‚‡ã†ã€‚";
  }

  // ãã®ä»–ã®ä¸­é–“ãƒ‘ã‚¿ãƒ¼ãƒ³
  return "å¿ƒç†çš„å®‰å…¨æ€§ã¨æŒ‘æˆ¦ã®ãƒãƒ©ãƒ³ã‚¹ã¯ä¸€å®šã®æ°´æº–ã¨ãªã£ã¦ã‚¤ãƒã‚¹ã‚¬ã€æ”¹å–„ã®ä½™åœ°ãŒã‚¢ãƒªãƒã‚¹ã€‚çµ„ç¹”ã®çŠ¶æ³ã‚’å®šæœŸçš„ã«ç¢ºèªã‚·ã€å°ã•ãªæ”¹å–„ã‚’ç©ã¿é‡ã­ã¦ã„ãã¾ã‚·ãƒ§ã‚¦ã€‚";
}
*/
function getResultComment(p, c) {
  // 1. ç†æƒ³çš„ãªçŠ¶æ…‹ï¼ˆæœ€ä¸Šä½ï¼‰
  if (p >= 70 && c >= 70) {
    return "ç†æƒ³çš„ãªçŠ¶æ…‹ã§ã™ã€‚ã“ã®çŠ¶æ…‹ã‚’ç¶™ç¶šã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚";
  }

  // 2. ã©ã¡ã‚‰ã‚‚ä½ã„ï¼ˆæœ€å„ªå…ˆã§ã‚­ãƒ£ãƒƒãƒï¼‰
  else if (p < 40 && c < 40) {
    return "å¿ƒç†çš„å®‰å…¨æ€§ã‚‚æŒ‘æˆ¦ã‚‚ä½ã„çŠ¶æ…‹ã§ã™ã€‚çµ„ç¹”ãŒåœæ»ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ãã€ã¾ãšã¯å®‰å¿ƒã§ãã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç’°å¢ƒã¥ãã‚Šã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚";
  }

  // 3. æŒ‘æˆ¦ãŒé«˜ã„ãŒå¿ƒç†çš„å®‰å…¨æ€§ãŒä½ã„ï¼ˆå±é™ºãªã‚¢ãƒ³ãƒãƒ©ãƒ³ã‚¹ï¼‰
  else if (p < 40 && c >= 60) {
    return "æŒ‘æˆ¦ã®ãƒ¬ãƒ™ãƒ«ã«å¯¾ã—ã¦å¿ƒç†çš„å®‰å…¨æ€§ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ã“ã®çŠ¶æ…‹ãŒç¶šãã¨ãƒ¡ãƒ³ãƒãƒ¼ã®è² æ‹…ãŒå¤§ããã€æŒç¶šçš„ãªæˆé•·ã¯é›£ã—ããªã‚Šã¾ã™ã€‚å¿ƒç†çš„å®‰å…¨æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã®çµ„ç¹”æ”¹å–„ãŒå¿…è¦ã§ã™ã€‚";
  }

  // 4. å¿ƒç†çš„å®‰å…¨æ€§ãŒé«˜ã„ãŒæŒ‘æˆ¦ãŒæ¥µç«¯ã«ä½ã„ï¼ˆã‚„ã‚ŠãŒã„ä¸è¶³ï¼‰
  else if (p >= 65 && c < 40) {
    return "å¿ƒç†çš„å®‰å…¨æ€§ã¯é«˜ã„çŠ¶æ…‹ã§ã™ãŒã€æŒ‘æˆ¦ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã¾ã¾ã§ã¯ã‚„ã‚ŠãŒã„ãŒä½ä¸‹ã—ã€é›¢è·ã«ã¤ãªãŒã‚‹æã‚ŒãŒã‚ã‚Šã¾ã™ã€‚å°‘ã—ãšã¤æŒ‘æˆ¦ãƒ¬ãƒ™ãƒ«ã‚’å¼•ãä¸Šã’ã¾ã—ã‚‡ã†ã€‚";
  }

  // 5. å¿ƒç†çš„å®‰å…¨æ€§ãŒé«˜ã‚ã§ã€æŒ‘æˆ¦ã¨ã®ã‚®ãƒ£ãƒƒãƒ—ãŒå¤§ãã„
  else if (p >= 65 && (p - c >= 15)) {
    return "å¿ƒç†çš„å®‰å…¨æ€§ã¯ã‚ã‚‹ç¨‹åº¦ç¢ºä¿ã•ã‚Œã¦ã„ã¾ã™ã€‚æŒ‘æˆ¦ãƒ¬ãƒ™ãƒ«ã‚’å¾ã€…ã«å¼•ãä¸Šã’ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚";
  }

  // 6. å¿ƒç†çš„å®‰å…¨æ€§ãŒä½ãã€æŒ‘æˆ¦ã¨ã®å·®ãŒã‚„ã‚„å¤§ãã„
  else if (p < 40 && (c - p >= 10)) {
    return "å¿ƒç†çš„å®‰å…¨æ€§ã‚’é«˜ã‚ã¦ã„ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å®‰å¿ƒã—ã¦æŒ‘æˆ¦ã§ãã‚‹ç’°å¢ƒã‚’å°‘ã—ãšã¤æ•´ãˆã¦ã„ãã¾ã—ã‚‡ã†ã€‚";
  }

  // 7. ãã®ä»–ï¼ˆä¸­é–“ã‚¾ãƒ¼ãƒ³ï¼‰
  else {
    return "å¿ƒç†çš„å®‰å…¨æ€§ã¨æŒ‘æˆ¦ã®ãƒãƒ©ãƒ³ã‚¹ã¯ä¸€å®šæ°´æº–ã«ã‚ã‚Šã¾ã™ãŒã€æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚å®šæœŸçš„ã«çŠ¶æ³ã‚’ç¢ºèªã—ã€å°ã•ãªæ”¹å–„ã‚’ç©ã¿é‡ã­ã¦ã„ãã¾ã—ã‚‡ã†ã€‚";
  }
}



// ================================
// çµæœè¡¨ç¤º
// ================================
function showResult() {
  chat.innerHTML = "";

  const adjusted = applyTermAdjustments(pScore, cScore, selectedTerms);

  // çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  addMsg("ğŸ¤–ï¼šè¨ºæ–­ã‚¬çµ‚ãƒ¯ãƒªãƒã‚·ã‚¿ï¼çµæœã¯ã‚³ãƒãƒ©ãƒ‡ã‚¹ï¼<br>", "bot");

  setTimeout(() => {
    addMsg2(
      `<span class="score">æŒ‘æˆ¦ã‚¹ã‚³ã‚¢: <strong style="font-size:24px;">${adjusted.C}</strong> / 100</span>
       <span class="score">å¿ƒç†çš„å®‰å…¨æ€§ã‚¹ã‚³ã‚¢: <strong style="font-size:24px;">${adjusted.P}</strong> / 100</span>`,
      "bot"
    );
  }, 1200);

  // â˜…ã“ã“ã§è¨ºæ–­ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤º
  setTimeout(() => {
    const comment = getResultComment(adjusted.P, adjusted.C);
    addMsg(`<br>ğŸ¤–ï¼šã€è¨ºæ–­ã‚³ãƒ¡ãƒ³ãƒˆã€‘<br>${comment}`, "bot");
  }, 2500);


  setTimeout(() => {
    addMsg("<br>ğŸ¤–ï¼šç¶šã‚±ãƒ†ã€ã‚¢ãƒŠã‚¿ã®çµ„ç¹”ï¼ˆãƒãƒ¼ãƒ ï¼‰ã®â€œå­¦ç¿’ã¨æˆé•·â€ã®çŠ¶æ…‹ã‚’è¡¨ã™ã€Šå¿ƒç†çš„å®‰å…¨æ€§â€•æŒ‘æˆ¦ãƒãƒˆãƒªã‚¯ã‚¹ã€‹ã‚’ä½œæˆã‚·ãƒã‚¹ã€‚", "bot");
  }, 4500);

  // ã‚°ãƒ©ãƒ•æç”»
  setTimeout(() => {
    const ctx = document.getElementById('resultChart').getContext('2d');
    const bgImage = new Image();
    bgImage.src = 'area.png';

    bgImage.onload = () => {
      new Chart(ctx, {
        type: 'scatter',
        data: {
          datasets: [{
            label: 'ãƒãƒ¼ãƒ ã®ç¾åœ¨ä½ç½®',
            data: [{ x: adjusted.P, y: adjusted.C }],
            backgroundColor: 'rgba(255,50,50,0.8)',
            pointRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          backgroundImage: bgImage,
          plugins: {
            legend: { display: false },
            title: {
              display: true,
              text: 'ã€Šå¿ƒç†çš„å®‰å…¨æ€§â€•æŒ‘æˆ¦ãƒãƒˆãƒªã‚¯ã‚¹ã€‹',
              font: { size: 18, weight: 'bold' },
              color: '#000',
              padding: { top: 10, bottom: 30 }
            }
          },
          layout: { padding: 0 },
          scales: {
            x: {
              title: { display: true, text: 'å¿ƒç†çš„å®‰å…¨æ€§ã‚¹ã‚³ã‚¢', color: '#000' },
              min: 0,
              max: 100,
              ticks: { stepSize: 20, color: '#000' },
              grid: { color: 'transparent' }
            },
            y: {
              title: { display: true, text: 'æŒ‘æˆ¦ã‚¹ã‚³ã‚¢', color: '#000' },
              min: 0,
              max: 100,
              ticks: { stepSize: 20, color: '#000' },
              grid: { color: 'transparent' }
            }
          }
        },
        plugins: [backgroundImagePlugin]
      });

      // âœ… ã‚°ãƒ©ãƒ•æç”»å®Œäº†å¾Œã«ãƒœã‚¿ãƒ³è¿½åŠ 
      setTimeout(() => {
        const buttonsContainer = document.getElementById("result-buttons");
        buttonsContainer.innerHTML = ""; // åˆæœŸåŒ–

        // å…±é€šãƒœã‚¿ãƒ³ä½œæˆé–¢æ•°
        const createButton = (tag, contentHtml, className, onClickOrHref) => {
        // tag: "a" ãªã‚‰ãƒªãƒ³ã‚¯ã€"button" ãªã‚‰ãƒœã‚¿ãƒ³ï¼ˆã¾ãŸã¯ "button" ä»¥å¤–ã¯ãƒœã‚¿ãƒ³æ‰±ã„ï¼‰
        const isLink = tag === "a";
        const el = document.createElement(isLink ? "a" : "button");

        // ã‚¯ãƒ©ã‚¹ã¯å…ˆã«ä»˜ä¸ã—ã¦ãŠã
        el.className = `action-btn ${className || ""}`;

        if (isLink) {
          // onClickOrHref ã¯ href ã®æ–‡å­—åˆ—ã¨ã—ã¦æ‰±ã†
          el.href = onClickOrHref || "#";
          el.target = "_blank";
          el.rel = "noopener noreferrer";
          // contentHtml ã‚’ HTML ã¨ã—ã¦æŒ¿å…¥ï¼ˆ<br>ã‚’åæ˜ ã•ã›ãŸã„å ´åˆã«å¿…è¦ï¼‰
          el.innerHTML = contentHtml;
        } else {
          // ãƒœã‚¿ãƒ³ã®å ´åˆã€onClickOrHref ã¯é–¢æ•°
          el.type = "button";
          el.innerHTML = contentHtml;
          if (typeof onClickOrHref === "function") {
            el.addEventListener("click", onClickOrHref);
          }
        }

          return el;
        };


        // â‘  Xã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³
        const shareBtn = createButton(
          "a",
          "Xã§ã‚·ã‚§ã‚¢ã™ã‚‹",
          "share-btn",
          createShareLink(adjusted.P, adjusted.C)
        );

        // â‘¡ å†è¨ºæ–­ãƒœã‚¿ãƒ³
        const retryBtn = createButton(
          "button",
          "ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹",
          "ghost",
          () => location.reload()
        );

        // â‘¢ noteãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒœã‚¿ãƒ³
        const noteBtn = createButton(
          "a",
          "ã“ã®è¨ºæ–­ã‚’ä½œã£ãŸäººã¯ã“ã¡ã‚‰<br>ï¼ˆnoteãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¸ï¼‰",
          "note-btn",
          "https://note.com/alc_chron2025"
        );

        // é…ç½®ï¼ˆä¸Šã‹ã‚‰é †ç•ªã«è¿½åŠ ï¼‰
        buttonsContainer.appendChild(shareBtn);
        buttonsContainer.appendChild(retryBtn);
        buttonsContainer.appendChild(noteBtn);
      }, 300); // å°‘ã—é…ã‚‰ã›ã¦è¡¨ç¤º
    };
  }, 7000);
}


// ================================
// Xã‚·ã‚§ã‚¢ãƒªãƒ³ã‚¯
// ================================
function createShareLink(p, c) {
  const text = `ãƒãƒ¼ãƒ è¨ºæ–­çµæœ\nå¿ƒç†çš„å®‰å…¨æ€§ã‚¹ã‚³ã‚¢: ${p}\næŒ‘æˆ¦ã‚¹ã‚³ã‚¢: ${c}\n#ãƒãƒ¼ãƒ è¨ºæ–­`;
  return `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
}

  </script>
</body>
</html>
