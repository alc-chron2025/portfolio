<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EQè¨ºæ–­ã‚¢ãƒ—ãƒª</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* =====================
Â  Â  Â  å…±é€šã‚¹ã‚¿ã‚¤ãƒ«Â 
Â  ===================== */
body {
font-family: "Hiragino Sans", "Arial", sans-serif;
background: #f0f4f8;
padding: 20px;
text-align: center;
color: #333;
}
#Screen {
max-width: 600px;
margin: 0 auto;
background: #fff;
border-radius: 16px;
box-shadow: 0 10px 25px rgba(0,0,0,0.05);
padding: 30px;
}
h2 { color: #007bff; margin-bottom: 20px; }

ul, ol {
list-style: none;
padding-left: 0;
margin: 0;
}

#startBtn {
background: linear-gradient(135deg, #007bff, #0056b3);
color: #fff;
padding: 15px 40px;
font-size: 18px;
font-weight: bold;
border: none;
border-radius: 30px;
cursor: pointer;
transition: transform 0.2s, box-shadow 0.2s;
}
#startBtn:hover {
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(0, 123, 255, 0.4);
}

/* è³ªå•ã‚¨ãƒªã‚¢ */
.status {
font-size: 18px;
margin-bottom: 24px;
font-weight: bold;
min-height: 60px;
display: flex;
align-items: center;
justify-content: center;
text-align: left;
padding: 0 10px;
}
.likert-container {
display: flex;
flex-direction: column;
align-items: center;
width: 100%;
margin: 20px auto;
}
.circles {
display: grid;
grid-template-columns: repeat(7, 1fr);
justify-items: center;
align-items: center;
gap: 8px;
margin-bottom: 10px;
}
.labels {
display: flex;
justify-content: space-between;
width: 100%;
max-width: 320px;
font-size: 12px;
color: #666;
}

/* å††ãƒœã‚¿ãƒ³ */
input[type="radio"] {
display: none !important;
visibility: hidden;
}
.circle {
display: flex;
justify-content: center;
align-items: center;
border-radius: 50%;
cursor: pointer;
transition: all 0.2s;
background-color: white;
border: 2px solid #ccc;
}
.size0 { width: 40px; height: 40px; }
.size1 { width: 34px; height: 34px; }
.size2 { width: 28px; height: 28px; }
.size3 { width: 24px; height: 24px; }

/* è‰²ä»˜ã‘ï¼ˆé¸æŠå‰ï¼‰*/
input[id$="_0"] + .circle { border-color: #f63f2a; color: #f63f2a; }
input[id$="_1"] + .circle { border-color: #fd6f03; color: #fd6d03; }
input[id$="_2"] + .circle { border-color: #ffcc01; color: #ffcc01; }
input[id$="_3"] + .circle { border-color: #fff700; color: #fff70083; }
input[id$="_4"] + .circle { border-color: #bffa10; color: #bffa10; }
input[id$="_5"] + .circle { border-color: #96f522; color: #55db1b; }
input[id$="_6"] + .circle { border-color: #07e061; color: #07e061; }
/* é¸æŠæ™‚ */
input[type="radio"]:checked + .circle {
background-color: currentColor;
border-color: currentColor;
box-shadow: 0 0 10px rgba(0,0,0,0.2);
}

/* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
.progress { margin-top: 20px; font-size: 14px; color: #888; }
#prevBtn, #nextBtn {
margin: 20px 10px;
padding: 10px 25px;
font-size: 16px;
border: none;
border-radius: 8px;
cursor: pointer;
font-weight: bold;
}
#nextBtn { background-color: #007bff; color: white; }
#prevBtn { background-color: #e0e0e0; color: #555; }

/* çµæœç”»é¢ */
.result-section {
margin-bottom: 25px;
padding: 15px;
background: #f9f9f9;
border-radius: 8px;
text-align: left;
}
.result-section h3 {
text-align: center;
margin-bottom: 10px;
}
.result-section p {
text-align: center;
}
.type-box {
margin-top: 15px;
padding: 15px;
border-radius: 8px;
text-align: center;
border: 2px solid;
}
.type-title {
font-size: 1.5em;
font-weight: bold;
}

.action-btn {
display: block;
width: 100%;
max-width: 300px;
margin: 10px auto;
padding: 12px;
border-radius: 30px;
text-align: center;
text-decoration: none;
font-weight: bold;
cursor: pointer;
box-sizing: border-box;
}

/* ãƒœã‚¿ãƒ³ã®è‰²è¨­å®š */
.share-btn { background-color: #000; color: #fff; }
.ghost { background-color: transparent; border: 2px solid #007bff; color: #007bff; }
.ghost:hover { background-color: #eef7ff; }
.note-btn {
background-color: #ddd;
border: 1px solid #999;
color: #333;
font-weight: normal;
}
.note-btn:hover { background-color: #efefef; }

/* ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢èª¿æ•´ */
#charts-area canvas {
max-height: 300px;
}
#matrix-area {
margin: 20px auto;
max-width: 450px;
}
#matrixChart {
/* æ­£æ–¹å½¢ã‚’æ‹…ä¿ã—ã€ã‹ã¤max-widthã‚’è¶…ãˆãªã„ã‚ˆã†ã«ã™ã‚‹ */
aspect-ratio: 1 / 1;
height: auto !important;
}


@media (max-width: 480px) {
.size0 { width: 32px; height: 32px; }
.size1 { width: 28px; height: 28px; }
.size2 { width: 24px; height: 24px; }
.size3 { width: 20px; height: 20px; }
.labels { max-width: 260px; }
}
</style>
</head>
<body>

<div id="Screen">

<div id="startScreen">
<h2>EQè¨ºæ–­</h2>
<p>ã‚ãªãŸã®EQï¼ˆå¿ƒã®çŸ¥èƒ½æŒ‡æ•°ï¼‰ã‚’<br>
5ã¤ã®é ˜åŸŸã§åˆ†æãƒ»ã‚¹ã‚³ã‚¢åŒ–ã—ã€<br>
ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã§è¡¨ç¤ºã—ã¾ã™ã€‚</p>

<ul style="text-align:left; display:inline-block; font-size:0.9em; color:#555;">
<li>ãƒ»è‡ªå·±èªè­˜</li>
<li>ãƒ»è‡ªå·±ç®¡ç†</li>
<li>ãƒ»ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³</li>
<li>ãƒ»å…±æ„Ÿ</li>
<li>ãƒ»ç¤¾ä¼šçš„ã‚¹ã‚­ãƒ«</li>
</ul>

<p>ã•ã‚‰ã«ã€Œã‚¿ã‚¹ã‚¯å¿—å‘ã€ã¨<br>
ã€Œé–¢ä¿‚æ€§å¿—å‘ã€ã®çµæœã‚’<br>
ãƒãƒˆãƒªã‚¯ã‚¹ã§è¡¨ç¤ºã—ã¾ã™ã€‚</p>
<br><br>
<button id="startBtn">è¨ºæ–­ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<div id="questionScreen" style="display: none;">
<div class="progress" id="progress">1 / 25</div>
<div class="status" id="questionText"></div>
<div class="likert-container">
<div class="circles" id="choices"></div>
<div class="labels">
<span>â—€ ãã†æ€ã‚ãªã„</span>
<span>ãã†æ€ã† â–¶</span>
</div>
</div>
<div>
<button id="prevBtn">æˆ»ã‚‹</button>
<button id="nextBtn">æ¬¡ã¸</button>
</div>
</div>

<div id="result-container" style="display:none; padding-bottom: 30px;">
<h2>EQè¨ºæ–­ã®çµæœ</h2>
<div id="charts-area"></div>

<div id="chara-area"></div>
<hr style="margin: 30px 0;">

<div id="analysis-area"></div>
<div id="matrix-area" style="width: 90%; max-width: 450px; margin: 20px auto;">
<canvas id="matrixChart"></canvas>
</div>

<div id="matrix-chara-area"></div>

<div id="result-buttons"></div>
</div>

</div>

<script>
/* =====================
Â  Â 0. è¨­å®š
===================== */
const questions = [
// A: è‡ªå·±èªè­˜
{ id:1, ability:"A", text:"è‡ªåˆ†ã®æ„Ÿæƒ…ãŒå¤‰åŒ–ã—ãŸã¨ãã€ãã®ç†ç”±ã‚’ã™ãã«ç†è§£ã§ãã‚‹", answer:null },
{ id:2, ability:"A", text:"è‡ªåˆ†ãŒä»Šã€ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’æ­£ç¢ºã«æŠŠæ¡ã§ãã‚‹", answer:null },
{ id:3, ability:"A", text:"è‡ªåˆ†ã®å¼·ã¿ã¨ã€èƒ½åŠ›ã®é™ç•Œï¼ˆå¼±ã¿ï¼‰ã‚’å®¢è¦³çš„ã«çŸ¥ã£ã¦ã„ã‚‹", answer:null },
{ id:4, ability:"A", text:"æ„Ÿæƒ…çš„ã«ãªã‚Šãã†ãªæ™‚ã€è‡ªåˆ†è‡ªèº«ã§ã€Œä»Šã€æ„Ÿæƒ…çš„ã ã€ã¨æ°—ã¥ã‘ã‚‹", answer:null },
{ id:5, ability:"A", text:"è‡ªåˆ†ã®è¡Œå‹•ãŒã€ãƒãƒ¼ãƒ ã®é›°å›²æ°—ã«ã©ã†å½±éŸ¿ã™ã‚‹ã‹ç†è§£ã—ã¦ã„ã‚‹", answer:null },

// B: è‡ªå·±ç®¡ç†
{ id:6, ability:"B", text:"äºˆæœŸã›ã¬ãƒˆãƒ©ãƒ–ãƒ«ãŒèµ·ãã¦ã‚‚ã€ãƒ‘ãƒ‹ãƒƒã‚¯ã«ãªã‚‰ãšå†·é™ã«å¯¾å‡¦ã—ã¦ã„ã‚‹", answer:null },
{ id:7, ability:"B", "text":"ã‚¤ãƒ©ã‚¤ãƒ©ã™ã‚‹ã“ã¨ãŒã‚ã£ã¦ã‚‚ã€ãã‚Œã‚’æ…‹åº¦ã«å‡ºã•ãšã«æ¥­å‹™ã‚’è¡Œã£ã¦ã„ã‚‹", answer:null },
{ id:8, ability:"B", text:"å¤±æ•—ã—ãŸã¨ãã€ã„ã¤ã¾ã§ã‚‚å¼•ããšã‚‰ãšã«æ°—æŒã¡ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã„ã‚‹", answer:null },
{ id:9, ability:"B", text:"å³ã—ã„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«å¯¾ã—ã¦ã€æ„Ÿæƒ…çš„ã«ãªã‚‰ãšã«å—ã‘æ­¢ã‚ã¦ã„ã‚‹", answer:null },
{ id:10, ability:"B", text:"ã‚„ã‚‹æ°—ãŒå‡ºãªã„æ™‚ã§ã‚‚ã€è‡ªã‚‰ã‚’å¾‹ã—ã¦ã‚¿ã‚¹ã‚¯ã‚’é‚è¡Œã—ã¦ã„ã‚‹", answer:null },

// C: å…±æ„Ÿ
{ id:11, ability:"C", text:"ç›¸æ‰‹ã®è¡¨æƒ…ã‚„å£°ã®ãƒˆãƒ¼ãƒ³ã‹ã‚‰ã€è¨€è‘‰ã«ã•ã‚Œãªã„æ„Ÿæƒ…ã‚’å¯Ÿã£ã—ã¦ã„ã‚‹", answer:null },
{ id:12, ability:"C", text:"è‡ªåˆ†ã¨ã¯ç•°ãªã‚‹æ„è¦‹ã‚„ä¾¡å€¤è¦³ã‚’æŒã¤äººã®ã“ã¨ã‚‚å°Šé‡ã—ã€ç†è§£ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹", answer:null },
{ id:13, ability:"C", text:"ãƒãƒ¼ãƒ å†…ã§å›°ã£ã¦ã„ã‚‹äººã‚„ã€ç™ºè¨€ã§ãã¦ã„ãªã„äººã«ã™ãæ°—ä»˜ã", answer:null },
{ id:14, ability:"C", text:"ç›¸æ‰‹ã®è©±ã‚’é®ã‚‰ãšã€æœ€å¾Œã¾ã§å‚¾è´ã—ã¦ã„ã‚‹", answer:null },
{ id:15, ability:"C", text:"ç›¸æ‰‹ã®ç«‹å ´ã«ç«‹ã£ã¦ç‰©äº‹ã‚’è€ƒãˆã¦ã„ã‚‹", answer:null },

// D: ç¤¾ä¼šçš„ï½½ï½·ï¾™
{ id:16, ability:"D", text:"åˆå¯¾é¢ã®äººã¨ã‚‚ã™ãã«æ‰“ã¡è§£ã‘ã€ä¿¡é ¼é–¢ä¿‚ã‚’ç¯‰ã„ã¦ã„ã‚‹", answer:null },
{ id:17, ability:"D", text:"æ„è¦‹ãŒå¯¾ç«‹ã—ãŸéš›ã€åŒæ–¹ã®è¨€ã„åˆ†ã‚’èã„ã¦èª¿æ•´ã—ã¦ã„ã‚‹", answer:null },
{ id:18, ability:"D", text:"è¨€ã„ã«ãã„ã“ã¨ã§ã‚ã£ã¦ã‚‚ã€ç›¸æ‰‹ã‚’å°Šé‡ã—ã€é©åˆ‡ã«ä¼ãˆã¦ã„ã‚‹", answer:null },
{ id:19, ability:"D", text:"å‘¨å›²ã®äººã‚’å·»ãè¾¼ã¿ãªãŒã‚‰ã€ãƒãƒ¼ãƒ ã®ç›®æ¨™é”æˆã«å‘ã‘ã¦å”åŠ›ä½“åˆ¶ã‚’ä½œã£ã¦ã„ã‚‹", answer:null },
{ id:20, ability:"D", text:"å ´ã®é›°å›²æ°—ãŒæ‚ªã„ã¨ãã«ã€ãã‚Œã‚’å‰å‘ãã«å¤‰ãˆã‚‹ã‚ˆã†ã«åƒãã‹ã‘ã¦ã„ã‚‹", answer:null },

// E: ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³
{ id:21, ability:"E", text:"é‡è¦ãªæ±ºå®šã‚’ã™ã‚‹éš›ã€ä¸€æ™‚çš„ãªæ„Ÿæƒ…ã«æµã•ã‚Œãšã«åˆ¤æ–­ã—ã¦ã„ã‚‹", answer:null },
{ id:22, ability:"E", text:"æ­£è§£ãŒãªã„çŠ¶æ³ã§ã‚‚ã€ãƒªã‚¹ã‚¯ã‚’è€ƒæ…®ã—ãŸä¸Šã§è‡ªåˆ†ã§æ±ºæ–­ã‚’ã—ã¦ã„ã‚‹", answer:null },
{ id:23, ability:"E", text:"ãƒãƒ¼ãƒ å…¨ä½“ã®åˆ©ç›Šã®ãŸã‚ãªã‚‰ã€æ™‚ã«å³ã—ã„æ±ºæ–­ã‚’è¡Œã†", answer:null },
{ id:24, ability:"E", text:"è¿·ã£ãŸã¨ãã¯ã€è«–ç†çš„ãªãƒ‡ãƒ¼ã‚¿ã¨è‡ªåˆ†ã®ç›´æ„Ÿã®ä¸¡æ–¹ã‚’æ´»ç”¨ã—ã¦ã„ã‚‹", answer:null },
{ id:25, ability:"E", text:"è‡ªåˆ†ã®æ±ºå®šã«å¯¾ã—ã¦ã€çµæœãŒã©ã†ã‚ã‚Œè²¬ä»»ã‚’æŒã¤è¦šæ‚Ÿã‚’æŒã£ã¦ã„ã‚‹", answer:null }
];

questions.forEach(q => q.answer = null);

/* =====================
Â  Â 1. åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯ (å¤‰æ›´ãªã—)
===================== */
let current = 0;
const total = questions.length;

const startScreen = document.getElementById("startScreen");
const questionScreen = document.getElementById("questionScreen");
const resultContainer = document.getElementById("result-container");
const questionText = document.getElementById("questionText");
const choicesDiv = document.getElementById("choices");
const progress = document.getElementById("progress");
const chartsArea = document.getElementById("charts-area");
const analysisArea = document.getElementById("analysis-area");
const charaArea = document.getElementById("chara-area");Â 
const matrixCharaArea = document.getElementById("matrix-chara-area");Â 
const btnArea = document.getElementById("result-buttons");

document.getElementById("startBtn").addEventListener("click", () => {
startScreen.style.display = "none";
questionScreen.style.display = "block";
renderQuestion();
});

function renderQuestion() {
const q = questions[current];
questionText.textContent = `Q${q.id}. ${q.text}`;
progress.textContent = `${current + 1} / ${total}`;
renderChoices();
document.getElementById("prevBtn").style.visibility = current === 0 ? "hidden" : "visible";
document.getElementById("nextBtn").textContent = current === total - 1 ? "çµæœã‚’è¦‹ã‚‹" : "æ¬¡ã¸";
}

function renderChoices() {
choicesDiv.innerHTML = "";
// 0, 1, 2, 3, 4, 5, 6 ã®7æ®µéšã€‚0ãŒã€Œãã†æ€ã‚ãªã„ã€, 6ãŒã€Œãã†æ€ã†ã€
for (let i = 0; i < 7; i++) {Â 
const input = document.createElement("input");
input.type = "radio";
input.name = "answer";
input.id = `q${current}_${i}`;
input.value = i;
const label = document.createElement("label");
let sizeClass = "size3";
if (i === 0 || i === 6) sizeClass = "size0";
else if (i === 1 || i === 5) sizeClass = "size1";
else if (i === 2 || i || 4) sizeClass = "size2";
label.className = `circle ${sizeClass}`;
label.setAttribute("for", input.id);
if (questions[current].answer === i) input.checked = true;
input.addEventListener("change", () => { questions[current].answer = i; });
choicesDiv.appendChild(input);
choicesDiv.appendChild(label);
}
}

document.getElementById("nextBtn").addEventListener("click", goNext);
document.getElementById("prevBtn").addEventListener("click", () => {
if (current > 0) { current--; renderQuestion(); }
});

function goNext() {
if (questions[current].answer === null) {
alert("å›ç­”ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
return;
}
if (current < total - 1) {
current++;
renderQuestion();
} else {
if (confirm("è¨ºæ–­ã‚’çµ‚äº†ã—ã¦çµæœã‚’è¡¨ç¤ºã—ã¾ã™ã‹ï¼Ÿ")) showResult();
}
}

/* =====================
Â  Â 2. é›†è¨ˆãƒ»çµæœè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯
===================== */
const mapName = {Â 
A:"è‡ªå·±èªè­˜",Â 
B:"è‡ªå·±ç®¡ç†",Â 
C:"å…±æ„Ÿ",Â 
D:"ç¤¾ä¼šçš„ï½½ï½·ï¾™",
E:"ï¾“ï¾ï¾ï¾ï½°ï½¼ï½®ï¾"
};

/**
* 5é ˜åŸŸã®ç”Ÿã‚¹ã‚³ã‚¢ (0-30) ã‚’è¨ˆç®—ã™ã‚‹ (å¤‰æ›´ãªã—)
*/
function calculateRawScores() {
const rawScores = { A:0, B:0, C:0, D:0, E:0 };
questions.forEach(q => { rawScores[q.ability] += Number(q.answer); });
return rawScores;
}

/**
* 5é ˜åŸŸã®æ­£è¦åŒ–ã‚¹ã‚³ã‚¢ (10ç‚¹æº€ç‚¹) ã‚’è¨ˆç®—ã™ã‚‹ (å¤‰æ›´ãªã—)
*/
function calculateNormalizedScores() {
const rawScores = calculateRawScores();
const normalized = {};
for (let key in rawScores) {
// 30ç‚¹æº€ç‚¹ï¼ˆ6ç‚¹ x 5å•ï¼‰ã‚’10ç‚¹æº€ç‚¹ã«æ­£è¦åŒ–
normalized[key] = parseFloat((rawScores[key] / 3).toFixed(1));
}
return normalized;
}

/**
* 2è»¸ï¼ˆé–¢ä¿‚æ€§å¿—å‘ãƒ»ã‚¿ã‚¹ã‚¯å¿—å‘ï¼‰ã®ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—ã—ã€100ç‚¹æº€ç‚¹ã«æ­£è¦åŒ–ã™ã‚‹ (å¤‰æ›´ãªã—)
*/
function calculateMatrixScores() {
const raw = calculateRawScores();

// é–¢ä¿‚æ€§å¿—å‘ (Xè»¸): C(å…±æ„Ÿ) + D(ç¤¾ä¼šçš„ï½½ï½·ï¾™)
const rawRelation = raw.C + raw.D;
const maxRelation = 6 * 5 * 2; // 6ç‚¹ x 5å• x 2é ˜åŸŸ = 60ç‚¹
// ã‚¿ã‚¹ã‚¯å¿—å‘ (Yè»¸): A(è‡ªå·±èªè­˜) + B(è‡ªå·±ç®¡ç†) + E(ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³)*0.2
const rawTask = raw.A + raw.B + (raw.E * 0.2);
const maxTask = 6 * 5 * 2.2; // 6ç‚¹ x 5å• x 2.2é ˜åŸŸ = 66ç‚¹

// æœ€å¤§å€¤ã‚’100ã«æƒãˆã‚‹æ­£è¦åŒ–
const scoreX = parseFloat(((rawRelation / maxRelation) * 100).toFixed(1));
const scoreY = parseFloat(((rawTask / maxTask) * 100).toFixed(1));

return { X: scoreX, Y: scoreY };
}


/**
Â * ã‚¹ã‚³ã‚¢ã®é«˜ã„é †ã«ä¸Šä½2ã¤ã®é ˜åŸŸï¼ˆã‚­ãƒ¼ï¼‰ã‚’å–å¾—ã™ã‚‹ (å¤‰æ›´ãªã—)
Â */
function getTopKeys(nScores) {
Â  Â  // å„ªå…ˆåº¦ã®å®šç¾© (A:5, B:4, E:3, C:2, D:1) - å€¤ãŒé«˜ã„æ–¹ãŒå„ªå…ˆ
Â  Â  const priority = { 'A': 5, 'B': 4, 'E': 3, 'C': 2, 'D': 1 };
Â  Â  
Â  Â  // ã‚¹ã‚³ã‚¢ã¨å„ªå…ˆé †ä½ã‚’çµ„ã¿åˆã‚ã›ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’ä½œæˆ
Â  Â  const sorted = Object.keys(nScores).map(key => ({
Â  Â  Â  Â  key: key,
Â  Â  Â  Â  score: nScores[key],
Â  Â  Â  Â  prio: priority[key] 
Â  Â  }))
Â  Â  .sort((a, b) => {
Â  Â  Â  Â  // 1. ã‚¹ã‚³ã‚¢ã§é™é †ã‚½ãƒ¼ãƒˆ
Â  Â  Â  Â  if (b.score !== a.score) {
Â  Â  Â  Â  Â  Â  return b.score - a.score;
Â  Â  Â  Â  }
Â  Â  Â  Â  // 2. ã‚¹ã‚³ã‚¢ãŒåŒç‚¹ã®å ´åˆã€prioï¼ˆå„ªå…ˆé †ä½ï¼‰ã§é™é †ã‚½ãƒ¼ãƒˆ
Â  Â  Â  Â  return b.prio - a.prio; 
Â  Â  });

Â  Â  // ä¸Šä½2ã¤ã‚’å–å¾—ã—ã€ã‚­ãƒ¼ã‚’ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«ã‚½ãƒ¼ãƒˆã—ã¦è¿”ã™ (AB, AC, ... ã®çµ„ã¿åˆã‚ã›ã‚’ä½œã‚‹ãŸã‚)
Â  Â  const topKeys = sorted.slice(0, 2).map(item => item.key);
Â  Â  return topKeys.sort();
}

/**
Â * ä¸Šä½2ã¤ã®é ˜åŸŸã®çµ„ã¿åˆã‚ã›ã«åŸºã¥ã„ã¦ç·åˆEQã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®šã™ã‚‹
Â * ã€ä¿®æ­£æ¸ˆã€‘: å…¨ã¦ã® return ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚¿ã‚¤ãƒ—åã‚’æ ¼ç´ã™ã‚‹ã‚­ãƒ¼ã‚’ 'name' ã«çµ±ä¸€ã€‚
Â */
function getEQType(topKeys, nScores) {
Â  Â  const top1 = topKeys[0];
Â  Â  const top2 = topKeys[1];
Â  Â  const comboKey = topKeys.join(''); // ä¾‹: ['A', 'B'] -> 'AB'

Â  Â  // åˆ¤å®šãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ— (å¤‰æ›´ãªã—)
Â  Â  const types = {
Â  Â  Â  Â  'AB': { name: "å®‰å®šã®ã‚»ãƒ«ãƒ•ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼", desc: "é«˜ã„è‡ªå·±ç†è§£ã«åŸºã¥ãã€æ„Ÿæƒ…ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã—è¡Œå‹•ã‚’å¾‹ã™ã‚‹ã‚¿ã‚¤ãƒ—", detail: "å†…çœåŠ›ã¨ç²¾ç¥çš„ãªå®‰å®šæ€§ã‚’æ­¦å™¨ã«ã€ãƒãƒ¼ãƒ ã®è¦ç¯„ã¨ãªã‚Šã¾ã™ã€‚è¨ˆç”»çš„ãªå®Ÿè¡ŒãŒå¾—æ„ã§ã™ã€‚", color: "#4CAF50" }, // Green
Â  Â  Â  Â  'AC': { name: "æ´å¯Ÿã®ã‚¨ãƒ³ãƒ‘ã‚¹", desc: "è‡ªåˆ†ã¨ä»–è€…ã®æ„Ÿæƒ…ã‚’æ·±ãç†è§£ã—ã€å¿ƒã®ç¹‹ãŒã‚Šã‚’é‡è¦–ã™ã‚‹ã‚¿ã‚¤ãƒ—", detail: "è‡ªå·±èªè­˜åŠ›ã§å®¢è¦³æ€§ã‚’ä¿ã¡ã¤ã¤ã€å…±æ„ŸåŠ›ã§ä»–è€…ã®ãƒ‹ãƒ¼ã‚ºã‚’çš„ç¢ºã«æŠŠæ¡ã—ã¾ã™ã€‚ã‚³ãƒ¼ãƒãƒ³ã‚°ã‚„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«å„ªã‚Œã¾ã™ã€‚", color: "#FFC107" }, // Yellow
Â  Â  Â  Â  'AD': { name: "èª¿æ•´åŠ›ã‚³ãƒ¼ãƒ‡ã‚£ãƒãƒ¼ã‚¿ãƒ¼", desc: "è‡ªå·±ã‚’å®¢è¦³è¦–ã—ã€ãã®ç†è§£ã‚’åŸºã«å¯¾äººé–¢ä¿‚ã‚’å††æ»‘ã«é€²ã‚ã‚‹ã‚¿ã‚¤ãƒ—", detail: "è‡ªåˆ†ã®é™ç•Œã‚„æ„Ÿæƒ…ã‚’æŠŠæ¡ã—ã¦ã„ã‚‹ãŸã‚ã€ç„¡ç†ãªãä»–è€…ã¨ã®å”åŠ›é–¢ä¿‚ã‚’ç¯‰ã‘ã¾ã™ã€‚ä¸­ç«‹çš„ãªç«‹å ´ã§å•é¡Œè§£æ±ºã‚’ã—ã¾ã™ã€‚", color: "#2196F3" }, // Blue
Â  Â  Â  Â  'AE': { name: "å†…ç™ºçš„ãƒ¢ãƒãƒ™ãƒ¼ã‚¿ãƒ¼", desc: "è‡ªå·±ã®ä¾¡å€¤è¦³ã¨ä¿¡å¿µã«åŸºã¥ãã€è‡ªã‚‰ç›®æ¨™è¨­å®šã—è¡Œå‹•ã‚’æ¨é€²ã™ã‚‹ã‚¿ã‚¤ãƒ—", detail: "ä½•ã®ãŸã‚ã«æ±ºæ–­ã™ã‚‹ã®ã‹ã€ã¨ã„ã†è»¸ãŒæ˜ç¢ºã§ã™ã€‚å‘¨å›²ã«ä¾å­˜ã›ãšã€å†…å´ã‹ã‚‰æ¹§ãå‡ºã‚‹ã‚¨ãƒãƒ«ã‚®ãƒ¼ã§ãƒãƒ¼ãƒ ã‚’é¼“èˆã—ã¾ã™ã€‚", color: "#F44336" }, // Red

Â  Â  Â  Â  'BC': { name: "æ¸©åšã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚¿ãƒ¼", desc: "å†·é™ã•ã¨å„ªã—ã•ã‚’å…¼ã­å‚™ãˆã€æ„Ÿæƒ…çš„ãªå¯¾ç«‹ã‚’å’Œã‚‰ã’ã‚‹ã‚¿ã‚¤ãƒ—", detail: "è‡ªå·±ç®¡ç†èƒ½åŠ›ã«ã‚ˆã‚Šã€ä»–è€…ã®æ„Ÿæƒ…ã«å¼•ããšã‚‰ã‚Œãšå®‰å®šã—ãŸå¯¾å¿œãŒã§ãã¾ã™ã€‚ãƒãƒ¼ãƒ ã®ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã§ã‚ã‚Šã€å¿ƒç†çš„å®‰å…¨æ€§ã‚’æä¾›ã—ã¾ã™ã€‚", color: "#9C27B0" }, // Purple
Â  Â  Â  Â  'BD': { name: "å†·é™æ²ˆç€ãªãƒãƒ©ãƒ³ã‚µãƒ¼", desc: "æ„Ÿæƒ…ã«æµã•ã‚Œãšå†·é™ãªæ…‹åº¦ã§ã€ç›®æ¨™é”æˆã«å‘ã‘ã¦ãƒãƒ©ãƒ³ã‚¹ã‚’ã¨ã‚ŠãªãŒã‚‰å”åŠ›ã‚’ä¿ƒã™ã‚¿ã‚¤ãƒ—", detail: "ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã§ã‚‚æ„Ÿæƒ…çš„ã«ãªã‚‰ãšã€æ·¡ã€…ã¨ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‹•æ©Ÿã¥ã‘ã‚‰ã‚Œã¾ã™ã€‚æ˜ç¢ºãªæŒ‡ç¤ºã¨ä¸€è²«ã—ãŸæ…‹åº¦ã§ä¿¡é ¼ã‚’é›†ã‚ã¾ã™ã€‚", color: "#00BCD4" }, // Cyan
Â  Â  Â  Â  'BE': { name: "é€†å¢ƒã«å¼·ã„ã‚¨ã‚¯ã‚¹ã‚­ãƒ¥ãƒ¼ã‚¿ãƒ¼", desc: "æ„Ÿæƒ…ã«å·¦å³ã•ã‚Œãšã«ã€ä¸€åº¦æ±ºã‚ãŸç›®æ¨™ã«å‘ã‹ã£ã¦ç€å®Ÿã«é€²ã‚€ã‚¿ã‚¤ãƒ—", detail: "æ±ºæ–­åŠ›ã¨è‡ªå·±è¦å¾‹ã‚’å…¼ã­å‚™ãˆã€é›£æ˜“åº¦ã®é«˜ã„ç›®æ¨™ã§ã‚‚è«¦ã‚ã¾ã›ã‚“ã€‚è¨ˆç”»é€šã‚Šã«å®Ÿè¡Œã—ãã‚‹åŠ›ãŒãƒãƒ¼ãƒ ã®æˆæœã‚’æ”¯ãˆã¾ã™ã€‚", color: "#FF9800" }, // Orange

Â  Â  Â  Â  'CD': { name: "å…±æ„Ÿã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚¿ãƒ¼", desc: "é«˜ã„å…±æ„ŸåŠ›ã¨ç¤¾äº¤æ€§ã§ã€ãƒãƒ¼ãƒ ã®å”åŠ›ä½“åˆ¶ã‚’è‡ªç„¶ã«æ§‹ç¯‰ã™ã‚‹ã‚¿ã‚¤ãƒ—", detail: "èª°ã¨ã§ã‚‚ä¿¡é ¼é–¢ä¿‚ã‚’ç¯‰ãã€ãƒ¡ãƒ³ãƒãƒ¼é–“ã®æ„Ÿæƒ…çš„ãªéšœå£ã‚’å–ã‚Šé™¤ãã¾ã™ã€‚å¤šæ§˜ãªæ„è¦‹ã‚’å°Šé‡ã—ã€çµ±åˆçš„ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¦‹å‡ºã›ã¾ã™ã€‚", color: "#8BC34A" }, // Light Green
Â  Â  Â  Â  'CE': { name: "æ”¯æ´å‹ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ£ãƒ¼", desc: "ä»–è€…ã®æ„Ÿæƒ…ã‚’è€ƒæ…®ã—ã¤ã¤ã€çš†ãŒç´å¾—ã§ãã‚‹æ±ºæ–­ã‚’å°ãã‚¿ã‚¤ãƒ—", detail: "ãƒ¡ãƒ³ãƒãƒ¼ã®æ°—æŒã¡ã‚’ç†è§£ã—ãŸä¸Šã§ã€å¿…è¦ãªæ±ºæ–­ã‚’å‹‡æ°—ã‚’æŒã£ã¦ä¸‹ã›ã¾ã™ã€‚æ„æ€æ±ºå®šãƒ—ãƒ­ã‚»ã‚¹ã«ãŠã‘ã‚‹ã€Œç´å¾—æ„Ÿã€ã‚’é‡è¦–ã—ã¾ã™ã€‚", color: "#E91E63" }, // Pink

Â  Â  Â  Â  'DE': { name: "ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãƒ»ãƒ•ã‚¡ã‚·ãƒªãƒ†ãƒ¼ã‚¿â€•", desc: "å¼·ã„å½±éŸ¿åŠ›ã¨æ±ºæ–­åŠ›ã§ã€å‘¨å›²ã‚’é¼“èˆã—ç›®æ¨™é”æˆã«å°ãã‚¿ã‚¤ãƒ—", detail: "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³èƒ½åŠ›ã§äººã‚’å‹•ã‹ã—ã€è¿·ã„ãªãæ±ºæ–­ã‚’ä¸‹ã—ã¾ã™ã€‚ç‰¹ã«å¤‰åŒ–ã®æ¿€ã—ã„çŠ¶æ³ã§ã€ãƒãƒ¼ãƒ ã‚’ç‰½å¼•ã™ã‚‹åŠ›ãŒã‚ã‚Šã¾ã™ã€‚", color: "#673AB7" }, // Deep Purple
Â  Â  };

Â  Â  const overallAvg = (nScores.A + nScores.B + nScores.C + nScores.D + nScores.E) / 5;
Â  Â  
Â  Â  // å…¨ã¦ã®ã‚¹ã‚³ã‚¢ãŒå¹³å‡4ç‚¹æœªæº€ (30ç‚¹æº€ç‚¹æ›ç®—ã§12ç‚¹æœªæº€) ã®å ´åˆ
Â  Â  if (Object.values(nScores).every(score => score < 4)) {
Â  Â  Â  Â  return { 
Â  Â  Â  Â  Â  Â  name: "æˆé•·æº–å‚™å‹", 
Â  Â  Â  Â  Â  Â  desc: "ç¾æ™‚ç‚¹ã§ã¯EQã®å„é ˜åŸŸã«æˆé•·ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚ç‰¹ã«è‡ªå·±èªè­˜ï¼ˆAï¼‰ã‚’é«˜ã‚ã‚‹ã“ã¨ã§ã€ä»–ã®é ˜åŸŸã®å‘ä¸Šã«ã‚‚ã¤ãªãŒã‚Šã¾ã™ã€‚", 
Â  Â  Â  Â  Â  Â  detail: "è‡ªå·±ç†è§£ã‹ã‚‰ä¸€æ­©ãšã¤å§‹ã‚ã€æœ€ã‚‚èˆˆå‘³ã‚’æŒã¦ã‚‹é ˜åŸŸï¼ˆãƒˆãƒƒãƒ—ã‚­ãƒ¼ï¼‰ã‚’æ„è­˜çš„ã«ä¼¸ã°ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚",
Â  Â  Â  Â  Â  Â  color: "#607D8B" // Grayish Blue
Â  Â  Â  Â  };
Â  Â  }

Â  Â  // ä¸Šä½2ã¤ã®çµ„ã¿åˆã‚ã›ã§åˆ¤å®š
Â  Â  const result = types[comboKey];
Â  Â  
Â  Â  // ç‰¹å®šã®çµ„ã¿åˆã‚ã›ãŒãªã„ã€ã¾ãŸã¯ã‚¹ã‚³ã‚¢ãŒéå¸¸ã«é«˜ã„å ´åˆã‚’ãƒãƒ©ãƒ³ã‚¹å‹ã¨ã™ã‚‹
Â  Â  if (!result || overallAvg >= 8) {
Â  Â  Â  Â  return { 
Â  Â  Â  Â  Â  Â  name: "ãƒãƒ©ãƒ³ã‚¹å‹ãƒ‘ãƒ¼ã‚½ãƒ³", 
Â  Â  Â  Â  Â  Â  desc: "å…¨èƒ½åŠ›ãŒå¹³å‡ä»¥ä¸Šã®ç·åˆã‚¿ã‚¤ãƒ—ã€‚ç‰¹å®šã®åã‚ŠãŒãªãã€å¹…åºƒã„å½¹å‰²ã‚’ã“ãªã›ã¾ã™ã€‚", 
Â  Â  Â  Â  Â  Â  detail: "ã™ã¹ã¦ã®EQé ˜åŸŸã§é«˜ã„èƒ½åŠ›ã‚’ç™ºæ®ã—ã¦ãŠã‚Šã€éå¸¸ã«ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã¾ã™ã€‚ã‚ãªãŸã®å®‰å®šæ€§ãŒãƒãƒ¼ãƒ ã®åœŸå°ã¨ãªã‚Šã¾ã™ã€‚", 
Â  Â  Â  Â  Â  Â  color: "#007bff" // Blue
Â  Â  Â  Â  };
Â  Â  }

Â  Â  // åˆ¤å®šçµæœã‚’è¿”ã™ (nameã‚­ãƒ¼ã«çµ±ä¸€)
Â  Â  return {
Â  Â  Â  Â  name: result.name, // ä¿®æ­£ç®‡æ‰€
Â  Â  Â  Â  desc: result.desc,
Â  Â  Â  Â  detail: result.detail,
Â  Â  Â  Â  color: result.color
Â  Â  };
}


/**
* ãƒãƒˆãƒªã‚¯ã‚¹åº§æ¨™ã«åŸºã¥ã„ãŸã‚³ãƒ¡ãƒ³ãƒˆåˆ¤å®š
* ã€ä¿®æ­£æ¸ˆã€‘: å³ä¸Šã‚¨ãƒªã‚¢ (X>=50, Y>=50) ã‚’ã•ã‚‰ã«4åˆ†å‰²
* @param {number} x - é–¢ä¿‚æ€§å¿—å‘ã‚¹ã‚³ã‚¢ (Xè»¸)
* @param {number} y - ã‚¿ã‚¹ã‚¯å¿—å‘ã‚¹ã‚³ã‚¢ (Yè»¸)
*/
function getMatrixComment(x, y) {
    const center = 50; // 50ç‚¹ã‚’ä¸­å¿ƒç·š
    const high = 75; // 75ç‚¹ã‚’é«˜ã‚¹ã‚³ã‚¢ã®é–¾å€¤
    
    // Yè»¸ï¼šä¸‹ï¼ˆä½ï¼‰ã€œä¸Šï¼ˆé«˜ï¼‰ã€Xè»¸ï¼šå·¦ï¼ˆä½ï¼‰ã€œå³ï¼ˆé«˜ï¼‰
    
    // === å³ä¸Šã‚¨ãƒªã‚¢ (X >= 50, Y >= 50) ã®è©³ç´°åˆ†å‰² ===
    if (x >= center && y >= center) {
        // A. ç†æƒ³ãƒãƒ©ãƒ³ã‚¹å‹ (X >= 75, Y >= 75)
        if (x >= high && y >= high) {
            return {
                type: "ğŸŒŸç†æƒ³ãƒãƒ©ãƒ³ã‚¹å‹",
                desc: "é–¢ä¿‚æ€§å¿—å‘ã€ã‚¿ã‚¹ã‚¯å¿—å‘ã¨ã‚‚ã«éå¸¸ã«é«˜ãã€ç†æƒ³çš„ãªãƒãƒ©ãƒ³ã‚¹ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚ã‚ãªãŸã¯ãƒãƒ¼ãƒ ã‚’æˆåŠŸã«å°ãæ ¸ã¨ãªã‚‹å­˜åœ¨ã§ã™ã€‚",
                color: "#4CAF50" // Green
            };
        }
        // B. ã‚¿ã‚¹ã‚¯å¼·ã¿å‹ (X < 75, Y >= 75)
        else if (y >= high) {
            return {
                type: "ã‚¿ã‚¹ã‚¯å„ªå…ˆãƒ»é«˜åŠ¹ç‡å‹",
                desc: "ã‚¿ã‚¹ã‚¯å¿—å‘ãŒç‰¹ã«é«˜ãã€æˆæœã‚’å‡ºã™ã“ã¨ã«é•·ã‘ã¦ã„ã¾ã™ã€‚é–¢ä¿‚æ€§ã‚‚å¹³å‡ä»¥ä¸Šã§ã™ãŒã€ã‚ˆã‚Šå††æ»‘ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã§ã€ã•ã‚‰ã«ãƒãƒ¼ãƒ å…¨ä½“ã®èƒ½åŠ›ã‚’ç™ºæ®ã§ãã¾ã™ã€‚",
                color: "#8BC34A" // Light Green
            };
        }
        // C. é–¢ä¿‚æ€§å¼·ã¿å‹ (X >= 75, Y < 75)
        else if (x >= high) {
            return {
                type: "é–¢ä¿‚æ€§å„ªå…ˆãƒ»é«˜å”èª¿å‹",
                desc: "é–¢ä¿‚æ€§å¿—å‘ãŒéå¸¸ã«é«˜ãã€ãƒãƒ¼ãƒ ã®èª¿å’Œã¨å”åŠ›ã‚’é‡è¦–ã—ã¾ã™ã€‚ã‚¿ã‚¹ã‚¯å¿—å‘ã‚‚å¹³å‡ä»¥ä¸Šã§ã™ãŒã€è‡ªå·±ç®¡ç†èƒ½åŠ›ã‚„æ±ºæ–­åŠ›ã‚’æ„è­˜çš„ã«é«˜ã‚ã‚‹ã“ã¨ã§ã€ãƒãƒ¼ãƒ ã‚’æˆåŠŸã«å°ãå­˜åœ¨ã«è¿‘ã¥ã‘ã¾ã™ã€‚",
                color: "#00BCD4" // Cyan
            };
        }
        // D. ãƒãƒ©ãƒ³ã‚¹å‹ (50 <= X < 75, 50 <= Y < 75)
        else {
            return {
                type: "ãƒãƒ©ãƒ³ã‚¹å‹",
                desc: "é–¢ä¿‚æ€§ã¨ã‚¿ã‚¹ã‚¯ã®ä¸¡æ–¹ã§å¹³å‡ä»¥ä¸Šã®æ°´æº–ã‚’ä¿ã£ã¦ã„ã¾ã™ã€‚ç‰¹å®šã®åã‚ŠãŒãªãã€å¹…åºƒã„å½¹å‰²ã‚’ã“ãªã›ã¾ã™ãŒã€ã©ã¡ã‚‰ã‚‚ã¾ã ä¼¸ã³ã—ã‚ãŒã‚ã‚Šã¾ã™ã€‚å…¨ä½“ãƒãƒ©ãƒ³ã‚¹ã‚’è¦‹ãªãŒã‚‰ã€â‘  è‡ªå·±èªè­˜ â†’ â‘¡ è‡ªå·±ç®¡ç† â†’ â‘¢ ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ â†’ â‘£ å…±æ„Ÿ â†’ â‘¤ ç¤¾ä¼šçš„ã‚¹ã‚­ãƒ«ã®é †ã§ä¼¸ã°ã—ã¦ã„ãã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚",
                color: "#4CAF50" // Green (ãƒ™ãƒ¼ã‚¹ã®è‰²ã‚’ç¶­æŒ)
            };
        }
    }
    // === ãã®ä»–ã®3è±¡é™ (å¤‰æ›´ãªã—) ===
    // 2. ä½é–¢ä¿‚æ€§/é«˜ã‚¿ã‚¹ã‚¯ (å·¦ä¸Š)
    else if (x < center && y >= center) {
        return {
            type: "ã‚¿ã‚¹ã‚¯åé‡å‹",
            desc: "ã‚¿ã‚¹ã‚¯å¿—å‘ã¯é«˜ã„ã‚‚ã®ã®ã€ä»–è€…ã¨ã®é–¢ä¿‚æ§‹ç¯‰ã‚„å…±æ„Ÿã®é¢ã§æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚å‘¨å›²ã¨ã®å”åŠ›ã‚„èª¿æ•´ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šå¤§ããªæˆæœã«ã¤ãªãŒã‚Šã¾ã™ã€‚",
            color: "#FFC107" // Yellow
        };
    }
    // 3. ä½é–¢ä¿‚æ€§/ä½ã‚¿ã‚¹ã‚¯ (å·¦ä¸‹)
    else if (x < center && y < center) {
        return {
            type: "ä¼¸ã³ã—ã‚å‹",
            desc: "ã‚¿ã‚¹ã‚¯å¿—å‘ã€é–¢ä¿‚æ€§å¿—å‘ã¨ã‚‚ã«æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãšã¯è‡ªå·±ç†è§£ã‚„è‡ªå·±ç®¡ç†ã‚’æ·±ã‚ã€è‡ªèº«ã®æ„Ÿæƒ…ã‚„è¡Œå‹•ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚EQã¯ç©ã¿æœ¨å‹ã§ã™ã€‚å…¨ä½“ãƒãƒ©ãƒ³ã‚¹ã‚’ã¨ã‚Šã¤ã¤ã€â‘  è‡ªå·±èªè­˜ â†’ â‘¡ è‡ªå·±ç®¡ç† â†’ â‘¢ ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ â†’ â‘£ å…±æ„Ÿ â†’ â‘¤ ç¤¾ä¼šçš„ã‚¹ã‚­ãƒ«ã®é †ã§è‚²ã¦ã¦ã„ãã®ãŒãŠã™ã™ã‚ã§ã™ã€‚",
            color: "#F44336" // Red
        };
    }
    // 4. é«˜é–¢ä¿‚æ€§/ä½ã‚¿ã‚¹ã‚¯ (å³ä¸‹)
    else { // x >= center && y < center
        return {
            type: "é–¢ä¿‚æ€§å”èª¿å‹",
            desc: "é–¢ä¿‚æ€§å¿—å‘ã¯é«˜ã„ã‚‚ã®ã®ã€ç›®æ¨™é”æˆã‚„è‡ªå·±è¦å¾‹ã®é¢ã§æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚å¯¾äººã‚¹ã‚­ãƒ«ã‚’æ´»ã‹ã—ã¤ã¤ã€ç›®æ¨™è¨­å®šã¨å®Ÿè¡ŒåŠ›ã‚’é«˜ã‚ã‚‹ã“ã¨ãŒéµã§ã™ã€‚",
            color: "#2196F3" // Blue
        };
    }
}


/**
* ãƒãƒˆãƒªã‚¯ã‚¹å›³ã®4è±¡é™èƒŒæ™¯ã‚’æç”»ã™ã‚‹Chart.jsãƒ—ãƒ©ã‚°ã‚¤ãƒ³
* ã€ä¿®æ­£æ¸ˆã€‘: å³ä¸Šã‚¨ãƒªã‚¢ã‚’ã•ã‚‰ã«4åˆ†å‰²ã—ã¦æç”»
*/
const quadrantPlugin = {
Â  id: 'quadrant',
Â  beforeDraw: (chart) => {
Â  Â  const { ctx, chartArea, scales } = chart;
Â  Â  const { x, y } = scales;

Â  Â  const center = 50; // ä¸­å¿ƒç·š
Â  Â  const high = 75; // æ–°ã—ã„é«˜ã‚¹ã‚³ã‚¢é–¾å€¤
Â  Â Â 
Â  Â  // 50ç‚¹ã¨75ç‚¹ã®ãƒ”ã‚¯ã‚»ãƒ«ä½ç½®ã‚’å–å¾—
Â  Â  const centerX = x.getPixelForValue(center);
Â  Â  const centerY = y.getPixelForValue(center);
Â  Â  const highX = x.getPixelForValue(high);
Â  Â  const highY = y.getPixelForValue(high);

Â  Â  ctx.save();
Â  Â  ctx.globalAlpha = 0.4;

Â  Â  // --- å·¦ä¸‹: ä½é–¢ä¿‚æ€§ / ä½ã‚¿ã‚¹ã‚¯ (X<50, Y<50) -> æ¶ˆæ¥µå‹ï¼ˆèµ¤ï¼‰---
Â  Â  ctx.fillStyle = '#F44336';
Â  Â  ctx.fillRect(chartArea.left, centerY, centerX - chartArea.left, chartArea.bottom - centerY);

Â  Â  // --- å·¦ä¸Š: ä½é–¢ä¿‚æ€§ / é«˜ã‚¿ã‚¹ã‚¯ (X<50, Y>=50) -> ã‚¿ã‚¹ã‚¯åé‡å‹ï¼ˆé»„ï¼‰---
Â  Â  ctx.fillStyle = '#FFC107';
Â  Â  ctx.fillRect(chartArea.left, chartArea.top, centerX - chartArea.left, centerY - chartArea.top);

Â  Â  // --- å³ä¸‹: é«˜é–¢ä¿‚æ€§ / ä½ã‚¿ã‚¹ã‚¯ (X>=50, Y<50) -> é–¢ä¿‚æ€§å”èª¿å‹ï¼ˆé’ï¼‰---
Â  Â  ctx.fillStyle = '#2196FF';
Â  Â  ctx.fillRect(centerX, centerY, chartArea.right - centerX, chartArea.bottom - centerY);

Â  Â  // --- å³ä¸Šã‚¨ãƒªã‚¢ (X>=50, Y>=50) ã®è©³ç´°åˆ†å‰² ---

Â  Â  // D. ã‚„ã‚„ãƒãƒ©ãƒ³ã‚¹å‹ (50 <= X < 75, 50 <= Y < 75)
Â  Â  ctx.fillStyle = '#4CFF50'; // ç·‘è‰²
Â  Â  ctx.fillRect(centerX, centerY, highX - centerX, highY - centerY);

Â  Â  // B. ã‚¿ã‚¹ã‚¯å¼·ã¿å‹ (50 <= X < 75, Y >= 75)
Â  Â  ctx.fillStyle = '#4CFF50'; // ç·‘è‰²
Â  Â  ctx.fillRect(centerX, chartArea.top, highX - centerX, highY - chartArea.top);

Â  Â  // C. é–¢ä¿‚æ€§å¼·ã¿å‹ (X >= 75, 50 <= Y < 75)
Â  Â  ctx.fillStyle = '#4CFF50'; // ç·‘è‰²
Â  Â  ctx.fillRect(highX, centerY, chartArea.right - highX, highY - centerY);

Â  Â  // A. ç†æƒ³ãƒãƒ©ãƒ³ã‚¹å‹ (X >= 75, Y >= 75)
Â  Â  ctx.fillStyle = '#00FF00'; // æ˜ã‚‹ã„ç·‘è‰²
Â  Â  ctx.fillRect(highX, chartArea.top, chartArea.right - highX, highY - chartArea.top);
Â  Â Â 

Â  Â  ctx.restore();

Â  Â  // ä¸­å¤®ç·šã¨æ–°é–¾å€¤ç·šã‚’æç”»
Â  Â  ctx.save();
Â  Â  ctx.strokeStyle = '#666';
Â  Â  ctx.lineWidth = 1;
Â  Â  ctx.setLineDash([2, 2]); // ç ´ç·šã®é–“éš”

Â  Â  // Xè»¸ä¸­å¤®ç·š (é–¢ä¿‚æ€§å¿—å‘50ç‚¹)
Â  Â  ctx.beginPath();
Â  Â  ctx.moveTo(centerX, chartArea.top);
Â  Â  ctx.lineTo(centerX, chartArea.bottom);
Â  Â  ctx.stroke();

Â  Â  // Yè»¸ä¸­å¤®ç·š (ã‚¿ã‚¹ã‚¯å¿—å‘50ç‚¹)
Â  Â  ctx.beginPath();
Â  Â  ctx.moveTo(chartArea.left, centerY);
Â  Â  ctx.lineTo(chartArea.right, centerY);
Â  Â  ctx.stroke();
Â  Â  
Â  Â  ctx.setLineDash([2, 2]); // ç ´ç·šã®é–“éš”

Â  Â  // Xè»¸75ç‚¹ç·š (å³ä¸Šã‚¨ãƒªã‚¢å†…ã®ã¿)
Â  Â  ctx.beginPath();
Â  Â  ctx.moveTo(highX, chartArea.top);
Â  Â  ctx.lineTo(highX, centerY);
Â  Â  ctx.stroke();

Â  Â  // Yè»¸75ç‚¹ç·š (å³ä¸Šã‚¨ãƒªã‚¢å†…ã®ã¿)
Â  Â  ctx.beginPath();
Â  Â  ctx.moveTo(centerX, highY);
Â  Â  ctx.lineTo(chartArea.right, highY);
Â  Â  ctx.stroke();

Â  Â  ctx.restore();
Â  }
};


function showResult() {
questionScreen.style.display = "none";
resultContainer.style.display = "block";
window.scrollTo(0,0);

const normalizedScores = calculateNormalizedScores();
const matrixScores = calculateMatrixScores();

// EQç·åˆã‚¿ã‚¤ãƒ—åˆ¤å®š
const topKeys = getTopKeys(normalizedScores); 
const overallResult = getEQType(topKeys, normalizedScores); 

// ãƒãƒˆãƒªã‚¯ã‚¹ã‚¿ã‚¤ãƒ—åˆ¤å®š
const matrixResult = getMatrixComment(matrixScores.X, matrixScores.Y); 

// --- â‘  ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ (5é ˜åŸŸã®ãƒãƒ©ãƒ³ã‚¹) ---
chartsArea.innerHTML = "";Â 
const radarCanvas = document.createElement("canvas");
chartsArea.appendChild(radarCanvas);
new Chart(radarCanvas, {
type: 'radar',
data: {
labels: [mapName.A, mapName.B, mapName.C, mapName.D, mapName.E],
datasets: [{
label: 'EQ 5é ˜åŸŸãƒãƒ©ãƒ³ã‚¹ (10ç‚¹æº€ç‚¹)',
data: [
Â  normalizedScores.A,Â 
Â  normalizedScores.B,Â 
Â  normalizedScores.C,Â 
Â  normalizedScores.D,Â 
Â  normalizedScores.E
],
backgroundColor: 'rgba(0, 123, 255, 0.2)',
borderColor: '#007bff',
pointBackgroundColor: '#007bff',
pointBorderWidth: 1,
borderWidth: 2
}]
},
options: {
scales: {
r: {
min: 0,
max: 10,Â 
ticks: { stepSize: 2 },
pointLabels: { font: { size: 12, weight: 'bold' } }Â 
}
},
plugins: {Â 
Â  legend: { display: true, position: 'bottom' },
Â  title: { display: true, text: 'ã€EQ 5é ˜åŸŸãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€‘', font: { size: 16, weight: 'bold' } }
}
}
});


// --- â‘¡ EQ ç·åˆã‚¿ã‚¤ãƒ—åˆ¤å®š (nameã‚­ãƒ¼ã‚’å‚ç…§) ---
charaArea.innerHTML = `
<div class="result-section">
<h3>ã‚ãªãŸã®EQã‚¿ã‚¤ãƒ—</h3>
<div class="type-box" style="border-color: ${overallResult.color}; background:#fff;">
<span class="type-title" style="color: ${overallResult.color};">${overallResult.name}</span>
<p style="margin-top:10px; font-weight:bold; text-align: left;">${overallResult.desc}</p>
<p style="font-size:0.9em; margin-top:10px; text-align: left;">
<span style="font-weight: bold;">è©³ç´°:</span> ${overallResult.detail}
</p>
</div>
</div>
`;


// --- â‘¢ 2è»¸ã‚¹ã‚³ã‚¢è¡¨ç¤º ---
analysisArea.innerHTML = `
<div class="result-section">
<h3>é–¢ä¿‚æ€§å¿—å‘ã¨ã‚¿ã‚¹ã‚¯å¿—å‘ã®ãƒãƒˆãƒªã‚¯ã‚¹</h3>
<p style="font-size:1.2em;">
Â é–¢ä¿‚æ€§å¿—å‘ã‚¹ã‚³ã‚¢: ${matrixScores.X} /100ç‚¹<br>
Â ã‚¿ã‚¹ã‚¯å¿—å‘ã‚¹ã‚³ã‚¢: ${matrixScores.Y} /100ç‚¹
</p>
</div>
`;

// --- â‘£ ãƒãƒˆãƒªã‚¯ã‚¹å›³ ---
// Chart.jsã¯ã‚­ãƒ£ãƒ³ãƒã‚¹ã®å†åˆ©ç”¨ã«å•é¡ŒãŒã‚ã‚‹ãŸã‚ã€å‰ã®ã‚°ãƒ©ãƒ•ãŒã‚ã‚Œã°ç ´æ£„ã¾ãŸã¯æ–°ã—ã„ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã®ãŒç†æƒ³
const matrixCanvas = document.getElementById('matrixChart');
if (matrixCanvas.chart) { matrixCanvas.chart.destroy(); }

// ç¸¦æ¨ªæ¯”ã‚’1:1 (æ­£æ–¹å½¢) ã«ã™ã‚‹ãŸã‚CSSã§é«˜ã•ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¾ã™ã€‚
matrixCanvas.chart = new Chart(matrixCanvas, {
Â  Â  type: 'scatter',
Â  Â  data: {
Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  label: 'ã‚ãªãŸã®ç¾åœ¨ä½ç½®',
Â  Â  Â  Â  Â  Â  data: [{ x: matrixScores.X, y: matrixScores.Y }],
Â  Â  Â  Â  Â  Â  backgroundColor: '#007bff',
Â  Â  Â  Â  Â  Â  pointRadius: 10,
Â  Â  Â  Â  Â  Â  pointBorderColor: '#fff',
Â  Â  Â  Â  Â  Â  pointBorderWidth: 2
Â  Â  Â  Â  }]
Â  Â  },
Â  Â  options: {
Â  Â  Â  Â  responsive: true,
Â  Â  Â  Â  maintainAspectRatio: false, 
Â  Â  Â  Â  aspectRatio: 1, // ç¸¦æ¨ªæ¯”ã‚’1:1 (æ­£æ–¹å½¢) ã«è¨­å®š
Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  legend: { display: false },
Â  Â  Â  Â  Â  Â  title: {
Â  Â  Â  Â  Â  Â  Â  Â  display: true,
Â  Â  Â  Â  Â  Â  Â  Â  text: 'ã€é–¢ä¿‚æ€§å¿—å‘ - ã‚¿ã‚¹ã‚¯å¿—å‘ ãƒãƒˆãƒªã‚¯ã‚¹ã€‘',
Â  Â  Â  Â  Â  Â  Â  Â  font: { size: 16, weight: 'bold' },
Â  Â  Â  Â  Â  Â  Â  Â  padding: { top: 0, bottom: 20 }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  tooltip: {
Â  Â  Â  Â  Â  Â  Â  Â  callbacks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: function(context) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `${matrixResult.type}: (X:${matrixScores.X}, Y:${matrixScores.Y})`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  },
Â  Â  Â  Â  scales: {
Â  Â  Â  Â  Â  Â  x: {
Â  Â  Â  Â  Â  Â  Â  Â  title: { display: true, text: 'â—€ é–¢ä¿‚æ€§å¿—å‘ã‚¹ã‚³ã‚¢ â–¶', font: { weight: 'bold' } },
Â  Â  Â  Â  Â  Â  Â  Â  min: 0,
Â  Â  Â  Â  Â  Â  Â  Â  max: 100,
Â  Â  Â  Â  Â  Â  Â  Â  ticks: { stepSize: 25, color: '#333' },
Â  Â  Â  Â  Â  Â  Â  Â  grid: { display: false }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  y: {
Â  Â  Â  Â  Â  Â  Â  Â  title: { display: true, text: 'â—€ ã‚¿ã‚¹ã‚¯å¿—å‘ã‚¹ã‚³ã‚¢ â–¶', font: { weight: 'bold' } },
Â  Â  Â  Â  Â  Â  Â  Â  min: 0,
Â  Â  Â  Â  Â  Â  Â  Â  max: 100,
Â  Â  Â  Â  Â  Â  Â  Â  ticks: { stepSize: 25, color: '#333' },
Â  Â  Â  Â  Â  Â  Â  Â  reverse: false, // ç¸¦è»¸ã®åè»¢ã‚’è§£é™¤ï¼ˆä¸‹:0, ä¸Š:100ï¼‰
Â  Â  Â  Â  Â  Â  Â  Â  position: 'left',
Â  Â  Â  Â  Â  Â  Â  Â  grid: { display: false }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  },
Â  Â  Â  Â  layout: { padding: { top: 0, bottom: 0, left: 10, right: 10 } }
Â  Â  },
Â  Â  plugins: [quadrantPlugin]
});


// --- â‘¤ ãƒãƒˆãƒªã‚¯ã‚¹ã‚¿ã‚¤ãƒ—åˆ¤å®š ---
matrixCharaArea.innerHTML = `
<div class="result-section">
<h3>ã‚ãªãŸã®è²¢çŒ®ã‚¿ã‚¤ãƒ—</h3>
<div class="type-box" style="border-color: ${matrixResult.color}; background:#fff;">
<span class="type-title" style="color: ${matrixResult.color}">${matrixResult.type}</span>
<p style="margin-top:10px; font-weight:bold; text-align: left;">${matrixResult.desc}</p>
</div>
</div>
<div class="type-box" style="text-align: left;">
<small>
â€»ã“ã‚Œã¯ã‚ãã¾ã§ã‚ãªãŸã®è‡ªå·±è©•ä¾¡ã®çµæœã§ã™ã€‚
è‡ªå·±è©•ä¾¡ãŒé«˜ã™ããŸã‚Šã€ä½ã™ãã¦ã—ã¾ã†ã¨ã€
å‘¨å›²ã‹ã‚‰ã®è©•ä¾¡ã¨ã‚ºãƒ¬ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ã§ã™ã®ã§ã€ãã®ç‚¹ã«ã¯ååˆ†ã«ã”ç•™æ„ãã ã•ã„ã­ã€‚
</small>
</p>
</div>
`;


// --- â‘¥ ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ (nameã‚­ãƒ¼ã‚’å‚ç…§) ---
const text = encodeURIComponent(`EQè¨ºæ–­çµæœï¼šç§ã®EQã‚¿ã‚¤ãƒ—ã¯ã€${overallResult.name}ã€‘ã€ãƒãƒ¼ãƒ è²¢çŒ®ã‚¿ã‚¤ãƒ—ã¯ã€${matrixResult.type}ã€‘ã§ã—ãŸï¼\nã‚¿ã‚¹ã‚¯å¿—å‘: ${matrixScores.Y}\né–¢ä¿‚æ€§å¿—å‘: ${matrixScores.X}\n#EQè¨ºæ–­ #ãƒãƒˆãƒªã‚¯ã‚¹`);
const shareUrl = `https://twitter.com/intent/tweet?text=${text}`;

btnArea.innerHTML = `
<a href="${shareUrl}" target="_blank" class="action-btn share-btn">çµæœã‚’Xã§ã‚·ã‚§ã‚¢</a>
<button onclick="location.reload()" class="action-btn ghost">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
<a href="https://note.com/alc_chron2025" target="_blank" class="action-btn note-btn">åˆ¶ä½œè€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« (note)</a>
`;
}
</script>

</body>
</html>